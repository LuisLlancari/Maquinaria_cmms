{% extends 'core/base.html' %} 

{% block titulo %}Inicio{% endblock %} 
{% block contenido %}

<style>
  .container {
    display: flex;
    flex-direction: row;
    padding: 15px;
  }

  #chartdiv {
    width: 70%;
    height: 500px;
    background-color: #f2f2f2;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    margin-right: 20px;
  }

  .other-div {
    width: 30%;
    background-color: #f2f2f2;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.text-center {
    text-align: center;
}

.form-group {
    margin-bottom: 20px;
}

.form-control {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 5px;
}

.btn-primary {
    display: block;
    width: 100%;
    padding: 10px;
    background-color: #007bff;
    border: none;
    border-radius: 5px;
    color: #fff;
    cursor: pointer;
    transition: background-color 0.3s;
}

.btn-primary:hover {
    background-color: #0056b3;
}
</style>

<div class="container">
  <div id="chartdiv"></div>
  <div class="other-div">
    <h3 class="text-center">Filtros Gráfico</h3>
    <form action="{% url 'reporteGrafico' %}" method="POST">
      {% csrf_token %}
        <div class="form-group">
            <label for="fecha_grafico" class="mt-5 mb-5">Filtrar por fecha de solicitudes:</label>
            <input type="date" class="form-control " id="fecha_grafico" name="fecha_grafico">
        </div>
        <button type="submit" class="btn btn-primary mt-5">Aplicar</button>
    </form>
</div>



<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
<script src="https://cdn.amcharts.com/lib/5/percent.js"></script>
<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

<script>
  var datos = JSON.parse("{% autoescape off %}{{ datagrafic | escapejs }}{% endautoescape %}");
  console.log(datos);
  if (Object.keys(datos).length !== 0) {
      am5.ready(function() {
          var root = am5.Root.new("chartdiv");
          root.setThemes([
              am5themes_Animated.new(root)
          ]);
          var chart = root.container.children.push(am5percent.PieChart.new(root, {
              layout: root.verticalLayout,
              innerRadius: am5.percent(50)
          }));
          var series = chart.series.push(am5percent.PieSeries.new(root, {
              valueField: "num_solicitudes",
              categoryField: "nombre",
              alignLabels: false
          }));
  
          series.labels.template.setAll({
              textType: "circular",
              centerX: 0,
              centerY: 0,
              text: "{category}: {value} solicitudes"
          });
  
          // Actualiza el gráfico con los datos
          series.data.setAll(datos);
          var legend = chart.children.push(am5.Legend.new(root, {
              centerX: am5.percent(50),
              x: am5.percent(50),
              marginTop: 15,
              marginBottom: 15,
          }));
          legend.data.setAll(series.dataItems);
          series.appear(1000, 100);
      });
  } else {
    am5.ready(function() {
      var root = am5.Root.new("chartdiv");
      root.setThemes([
          am5themes_Animated.new(root)
      ]);
      var chart = root.container.children.push(am5percent.PieChart.new(root, {
          layout: root.verticalLayout,
          innerRadius: am5.percent(50)
      }));
  
      var series = chart.series.push(am5percent.PieSeries.new(root, {
          valueField: "value",
          categoryField: "category",
          alignLabels: false
      }));
  
      series.labels.template.setAll({
          textType: "circular",
          centerX: 0,
          centerY: 0,
          text: ""
      });
  
      // Datos ficticios
      var data = [
          { "value": 10 }
      ];
  
      // Actualiza el gráfico con los datos ficticios
      series.data.setAll(data);
  
      var legend = chart.children.push(am5.Legend.new(root, {
          centerX: am5.percent(50),
          x: am5.percent(50),
          marginTop: 15,
          marginBottom: 15,
      }));
      legend.data.setAll(series.dataItems);
      series.appear(1000, 100);
  });
  
  }
  
</script>


  




</script>

<script src="https://code.highcharts.com/highcharts.js"></script>
{% endblock %}
